#!/usr/bin/env sh
#-
# Copyright (c) 2020-2021 Hervy Qurrotul Ainur Rozi <hervyqa@pm.me>.
#
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#-

# Make sure we don't inherit these from env.

name=$(basename "$0")
title="LangitKetujuh OS"
version="1.1"
license="BSD 2-Clause"
locale="en_uS.UTF-8"
pwd=$(pwd)

usage()
{
cat <<- EOF

builder     : $title installer
license     : $license
usage       : sudo sh $name [options]

options     : --lite-musl   -lm   # build lite musl edition
              --lite-glibc  -lg   # build lite glibc edition
              --pro-musl    -pm   # build pro musl edition
              --pro-glibc   -pg   # build pro glibc edition

              --deps-musl   -dm   # download only musl packages
              --deps-glibc  -dg   # download only glibc packages

              --help        -h    # print this help
              --version     -v    # print $name version

example     : sudo sh $name lite-musl

EOF
}

grub="grub-i386-efi grub-x86_64-efi"
base="base-system dialog cryptsetup lvm2 mdadm"
initrd="dracut dracut-uefi dracut-network"
network="dhcpcd wpa_supplicant NetworkManager ntp"
firmware="linux-firmware linux-firmware-intel linux-firmware-amd linux-firmware-nvidia linux-firmware-network broadcom-bt-firmware broadcom-bt-firmware dkms"
driver="xorg xf86-input-evdev xf86-input-joystick xf86-input-libinput xf86-input-mtrack xf86-input-synaptics xf86-input-vmmouse xf86-input-wacom xorg-minimal xorg-input-drivers xorg-video-drivers mesa-ati-dri mesa-intel-dri mesa-nouveau-dri"
utils="setxkbmap xauth xrandr libvdpau-va-gl vdpauinfo font-misc-misc alsa-plugins-pulseaudio pipewire gstreamer1-pipewire alsa-utils paprefs inetutils usbutils wget curl testdisk gptfdisk xclip xclipboard wl-clipboard yank git ytop inxi xtools vsv tlp bash-completion vim bootiso bc mtools tmate pwgen fish-shell acpilight android-udev-rules android-tools gnome-color-manager ddgtk vte3 nano zenity librsvg-utils ImageMagick"
codec="gst-plugins-base1 gst-plugins-good1 gst-plugins-ugly1 gst-plugins-bad1 gst-libav ffmpeg faac faad2 flac jasper lame libdca libmpeg2 libmad libtheora libvorbis libXv wavpack x264 xvidcore gstreamer-vaapi"
archiver="atool p7zip zip unzip lzop lzip dtrx file-roller liblz4 lz4"
pkgmgmt="tuxc topgrade flatpak"
disk="exfat-utils fuse-exfat gvfs-afc gvfs-mtp gvfs-smb udisks2 ntfs-3g elogind dbus-elogind dbus-elogind-x11 gnome-keyring xdg-utils xdg-desktop-portal xdg-desktop-portal-gtk xdg-desktop-portal-kde xdg-user-dirs xdg-user-dirs-gtk libappindicator AppStream"
compiler="automake binutils bison fakeroot flex gcc libtool m4 make patch pkg-config guile qemu-user-static"
printer="bluez-cups cups cups-pdf cups-filters gutenprint system-config-printer system-config-printer-udev hplip epson-inkjet-printer-escpr foomatic-db brother-brlaser"
kde5="sddm kde5 kdesu kde5-baseapps kaccounts-integration kaccounts-providers konsole5 upower dolphin dolphin-plugins kimageformats plasma-browser-integration plasma-disks plasma-nm plasma-pa colord-kde kio-extras kio-gdrive kcm-wacomtablet plasma-wayland-protocols kdegraphics-thumbnailers ffmpegthumbnailer ffmpegthumbs media-player-info"
kde5_apps="kdeconnect print-manager spectacle ark k3b kid3 kwalletmanager filelight kcalc kget ktorrent okular vokoscreen kcolorchooser kmediaplayer kaffeine elisa kolourpaint kmail kontact akregator gwenview krfb krdc partitionmanager konversation octoxbps skanlite soundkonverter korganizer"
fonts="terminus-font dejavu-fonts-ttf xorg-fonts noto-fonts-emoji liberation-fonts-ttf unicode-character-database unicode-emoji"
browser="icecat"
vector="inkscape"
raster="gimp"
color="python-dbus dispcalGUI"
office="libreoffice libreoffice-kde"
musl="gcompat"
glibc="glibc-locales"

# PRO Edition
plugins="gmic gmic-gimp gimp-lqr-plugin xsane-gimp resynthesizer"
photography="digikam rawtherapee hugin"
video_editor="kdenlive"
font_maker="fontforge"
painting="krita"
record="obs"
publish="scribus"
animation="blender synfigstudio opentoonz"
audio_pro="jack jack_capture sox audacity ardour cadence"
fonts_extra="google-fonts-ttf font-awesome5 font-material-design-icons-ttf font-ionicons-ttf"
game_dev_linux="godot scons yasm pkgconf libXcursor libXinerama libXi libXrandr alsa-lib libpulseaudio libgudev gcc-objc++ xorgproto libfreeglut pulseaudio llvm clang fuse icu zlib bzip2"
#game_dev_win="cross-x86_64-w64-mingw32 cross-i686-w64-mingw32 python3-pip"
#game_dev_apk="gradle android-tools openjdk"

for arg in "$@"; do
    case $arg in
        --lite-musl|-lm)
            sh mklive.sh \
            -a x86_64-musl \
            -c $pwd/xbps-cachedir-x86_64-musl \
            -I $pwd/includedir/lite/musl \
            -l "$locale" \
            -p "$grub $base $initrd $network $firmware $driver $utils $codec $archiver $pkgmgmt $disk $compiler $printer $kde5 $kde5_apps $browser $vector $raster $color $fonts $office $musl"
            echo "\033[1;33mFinish\033[0m"
            ;;
        --lite-glibc|-lg)
            sh mklive.sh \
            -a x86_64 \
            -c $pwd/xbps-cachedir-x86_64 \
            -I $pwd/includedir/lite/glibc \
            -l "$locale" \
            -p "$grub $base $initrd $network $firmware $driver $utils $codec $archiver $pkgmgmt $disk $compiler $printer $kde5 $kde5_apps $browser $vector $raster $color $fonts $office $glibc"
            echo "\033[1;33mFinish\033[0m"
            ;;
        --pro-musl|-pm)
            sh mklive.sh \
            -a x86_64-musl \
            -c $pwd/xbps-cachedir-x86_64-musl \
            -I $pwd/includedir/pro/musl \
            -l "$locale" \
            -p "$grub $base $initrd $network $firmware $driver $utils $codec $archiver $pkgmgmt $disk $compiler $printer $kde5 $kde5_apps $browser $vector $raster $color $fonts $office $musl $plugins $photography $video_editor $font_maker $painting $record $publish $animation $audio_pro $fonts_extra $game_dev_linux $game_dev_win $game_dev_apk"
            echo "\033[1;33mFinish\033[0m"
            ;;
        --pro-glibc|-pg)
            sh mklive.sh \
            -a x86_64 \
            -c $pwd/xbps-cachedir-x86_64 \
            -I $pwd/includedir/pro/glibc \
            -l "$locale" \
            -p "$grub $base $initrd $network $firmware $driver $utils $codec $archiver $pkgmgmt $disk $compiler $printer $kde5 $kde5_apps $browser $vector $raster $color $fonts $office $glibc $plugins $photography $video_editor $font_maker $painting $record $publish $animation $audio_pro $fonts_extra $game_dev_linux $game_dev_win $game_dev_apk"
            echo "\033[1;33mFinish\033[0m"
            ;;
        --help|-h)
            usage
            exit 0
            ;;
        --version|-v)
            echo "\033[1;33m $name\033[0m version $version"
            exit 0
            ;;
        *)
            printf "\noption does not exist: %s\n\n" "$arg"
            exit 2
    esac
done
